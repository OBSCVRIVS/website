<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Levi Carver</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="theme-color" content="#FFFFFF">

  <!-- Markdown + Sanitizer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.9/dist/purify.min.js" defer></script>
</head>
<body>

<!-- TOP NAV (now above banner) -->
<nav class="site-nav site-nav--top" aria-label="Site">
  <div class="site-nav__inner">
    <a class="brand" href="/">Levi Carver</a>
    <a class="nav-link" href="contact.html">Contact</a>
  </div>
</nav>

<!-- PROFILE HEADER: short banner + overlapping avatar + meta -->
<header class="profile-header" role="banner" aria-label="Profile">
  <div class="banner">
    <img src="assets/img/banner_blue_hour.png" alt="Blue hour banner">
  </div>

  <div class="profile-header__inner">
    <img class="avatar avatar--overlap" src="assets/img/avatar_anime_blue_hour.png" alt="Portrait of Levi">
    <div class="hero-meta">
      <h1 id="hero-title">Levi Carver</h1>
      <p class="tagline">Technical Product Specialist · Los Angeles, California, USA</p>
      <nav class="social" aria-label="Social">
        <ul>
          <li><a href="https://linkedin.com/in/levicarver" rel="me noopener" target="_blank">LinkedIn</a></li>
          <li><a href="https://github.com/USERNAME" rel="me noopener" target="_blank">GitHub</a></li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<main id="main">
  <!-- ABOUT (clamped with toggle) -->
  <section class="about" aria-labelledby="about-title">
    <h2 id="about-title">About</h2>
    <p id="about-text" class="clamp-3">
      I work in tech with a focus on improving digital systems and making them more accessible for everyone.
      I value empathy, open communication, and learning from different perspectives, which guide how I approach challenges both professionally and personally.
      I’m passionate about debate, political news, and strategy games like chess, all of which push me to think critically and see issues from multiple angles.
      At the core of everything I do is a desire to understand people’s experiences and use that understanding to help create meaningful change.
    </p>
    <button id="about-toggle" class="linklike" aria-expanded="false" aria-controls="about-text">more…</button>
  </section>

  <!-- NOTES (tweet-style) -->
  <section class="feed" aria-labelledby="feed-title">
    <h2 id="feed-title">Notes</h2>
    <div id="notes"></div>
    <nav class="pager" aria-label="Pagination">
      <button id="newer" disabled>Newer</button>
      <button id="older" disabled>Older</button>
    </nav>
  </section>
</main>

<footer class="footer" role="contentinfo">
  <small>© 2025 Levi Carver · <a href="contact.html">Contact</a></small>
</footer>

<script>
  // ===== Markdown helper =====
  window.MD = {
    parse(md){
      marked.setOptions({ gfm:true, breaks:false, headerIds:true, mangle:false });
      const html = marked.parse(md || "");
      return DOMPurify.sanitize(html, {
        ADD_ATTR:['target','rel'],
        FORBID_TAGS:['script','style']
      });
    }
  };

  // ===== About expand/collapse =====
  (function () {
    const text = document.getElementById('about-text');
    const btn = document.getElementById('about-toggle');
    btn.addEventListener('click', () => {
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      btn.setAttribute('aria-expanded', String(!expanded));
      text.classList.toggle('clamp-3', expanded);
      btn.textContent = expanded ? 'more…' : 'less';
      if (!expanded) text.classList.remove('clamp-3');
    });
  }());

  // ===== Notes render (from /api/notes) with Markdown =====
  (async function () {
    const pageSize = 10;
    let page = 0;
    const container = document.getElementById('notes');
    const newer = document.getElementById('newer');
    const older = document.getElementById('older');
    let notes = [];

    function fmtTime(iso, tz){
      const d = new Date(iso);
      const zone = tz || Intl.DateTimeFormat().resolvedOptions().timeZone;
      const ds = d.toLocaleString(undefined, { month:'short', day:'numeric' });
      const ts = d.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit', hour12:false, timeZone: zone });
      const tzLabel = new Intl.DateTimeFormat(undefined, { timeZoneName:'short', timeZone: zone })
        .formatToParts(d).find(p=>p.type==='timeZoneName')?.value || zone;
      return `${ds} · ${ts} ${tzLabel}`;
    }

    async function load(){
      try {
        const r = await fetch('/api/notes', { headers: { 'Accept':'application/json' } });
        if (!r.ok) throw new Error('Failed to fetch notes');
        notes = await r.json();
        render();
      } catch {
        container.innerHTML = '<p class="muted">Could not load notes.</p>';
      }
    }

    function render(){
      container.innerHTML = '';
      const start = page * pageSize;
      const slice = notes.slice(start, start + pageSize);
      slice.forEach(n => {
        const card = document.createElement('article');
        card.className = 'tweet';
        card.id = n.id;

        card.innerHTML = `
          <div class="tweet__avatar"><img src="assets/img/avatar_anime_blue_hour.png" alt="" aria-hidden="true"></div>
          <div class="tweet__body">
            <header class="tweet__head">
              <span class="name">Levi Carver</span>
              <span class="dot" aria-hidden="true">·</span>
              <time datetime="${n.created_at}">${fmtTime(n.created_at, n.tz)}</time>
            </header>
            <div class="tweet__text">${MD.parse(n.body)}</div>
           <div class="tweet__actions">
<a class="permalink" href="notes/${n.id}" aria-label="Permalink">
  <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M10.172 13.828a4 4 0 0 0 5.656 0l3-3a4 4 0 1 0-5.656-5.656l-1.172 1.172"/>
    <path d="M13.828 10.172a4 4 0 0 0-5.656 0l-3 3a4 4 0 1 0 5.656 5.656l1.172-1.172"/>
  </svg>
  <span class="sr-only">Permalink</span>
</a>
</div>
          </div>
        `;

        card.addEventListener('click', (ev) => {
          if (ev.target.closest('a,button')) return;
          card.classList.toggle('expanded');
        });

        container.appendChild(card);
      });

      container.querySelectorAll('.tweet__text a').forEach(a=>{
        a.target = '_blank'; a.rel = 'noopener noreferrer';
      });

      newer.disabled = page === 0;
      older.disabled = (start + pageSize) >= notes.length;
    }

    newer.addEventListener('click', ()=>{ if(page>0){ page--; render(); }});
    older.addEventListener('click', ()=>{ if((page+1)*pageSize < notes.length){ page++; render(); }});

    await load();
  }());
</script>

<!-- ===== Theme: auto by local clock (no geo) ===== -->
<script>
(function () {
  const LIGHT_START_H = 7;   // 07:00 local
  const LIGHT_END_H   = 19;  // 19:00 local

  function applyThemeByClock() {
    const now = new Date();
    const h = now.getHours();
    const mode = (h >= LIGHT_START_H && h < LIGHT_END_H) ? 'light' : 'dark';
    const html = document.documentElement;
    html.setAttribute('data-theme', mode);

    const bg = getComputedStyle(html).getPropertyValue('--bg').trim();
    let meta = document.querySelector('meta[name="theme-color"]');
    if (!meta) { meta = document.createElement('meta'); meta.name = 'theme-color'; document.head.appendChild(meta); }
    meta.setAttribute('content', bg);
  }

  applyThemeByClock();
  setInterval(applyThemeByClock, 15*60*1000);
})();
</script>
</body>
</html>
